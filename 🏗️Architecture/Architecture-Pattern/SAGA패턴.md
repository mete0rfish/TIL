# 개요
MSA의 중요한 원칙 중 하나는 MSA 당 한 개의 DB를 사용해야 한다.

여러 서비스가 한개의 DB를 공유할 경우, 다른 서비스 팀과 협의 해야한다.
이는 분산된 모놀리스에 불과하기에 안티 패턴으로 불리운다.

그런데 이렇게 DB를 분리해서 쓸 경우, ACID 트랜잭션이 보장되지 않는다.

이를 위해 등장한 것이 Saga 패턴이다.

# 등장
![alt text](image.png)
만약 작업이 실패하면 롤백하기 위해 반대되는 보상 작업을 수행
![alt text](image-1.png)

# 구현
크게 오케스트레이션을 사용한 방법과 메시지브로커를 사용하는 코레오그래피 방법이 있다.

# 실제 사례
라이브 공연, 영화, 연극 등 행사 티켓을 판매하는 기업
해당 행사 티켓이 있고, 각 티켓은 공연장의 특정 좌석에 할당되어 있음
고객이 티켓을 구매하면 그 좌석을 이용

1. 사용자가 봇이나 블랙리스트 인지 검증 필요
2. 결제한 금액을 받았는지 확인
3. 좌석당 1장의 티켓을 판매하는지 확인

### 모놀리식이면
단일 트랜잭션으로 작업을 처리할 수 있음.

### MSA에서
모든 요구사항을 서비스 별로 별도의 서버가 병렬처리한다.
만약 하나의 서버가 Pending이 되더라도 다른 서비스는 정상 작동한다.
그런데 timeout으로 실패가 발생하면, 이미 성공했던 나머지 서비스들은 모두 보상 트랜잭션을 수행한다.
