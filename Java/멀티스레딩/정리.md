# 2. 스레딩 기초 - 스레드 생성

### Thread.start() vs. Thread.run()

- start() : 새로운 스레드 생성 후 run() 호출 -> 멀티 스레드
- run() : 스레드 생성 없이 run()만 실행 -> 싱글 스레드

### 스레드 정지하는 ㅣㅇ유
1. 스레드는 아무것도 안해도 리소스를 사용한다.
2. 스레드 오작동 시 주징해야 한다.
3. 메인 스레드가 멈춰도 다른 스레드가 살하있으면 애플리케이션이 종료되지 않는다.

### thread.interrupt()

```java
Thread thread = new Thread(new CustomRunnable());
thread.start();

private static class CustomRunnable implements Runnable {
    
    @Override
    public void run() {
        try {
            while(true) {
                char input = (char) System.in.read();
                if(input == 'q') {
                    return;
                }
            }
        } catch (IOException e) {
            
        }
    }
}
```

스레드가 유저의 인풋을 받는 동안 당연하게도 스레드 블로킹이 발생한다. 이 상태를 벗어나기 위해 interrupt()를 사용한다.
이 때 interrupt()만 호출하지 않고 이를 catch할 수 있는 구문 추가도 필요하다.

```java
Thread thread = new Thread(new CustomRunnable());
thread.start();
thread.interrupt();

private static class CustomRunnable implements Runnable {
    
    @Override
    public void run() {
        try {
            while(true) {
                if(Thread.currentThread().interrupt()) {
                    break;
                }
                char input = (char) System.in.read();
                if(input == 'q') {
                    return;
                }
            }
        } catch (IOException e) {
            
        }
    }
}
```

# 3. 성능 최적화
## 성능 및 지연 시간 최적화 개요
성능 메트릭은 상황마다 다를 수 있다. 예를 들어 주식 트레이딩 프로그램에선 성능 메트릭은 지연시간이다. 그러나 비디오 플레이어에선 프레임 레이트의 정확도가 성능 메트릭이 된다. 마지막으로 댜규모 데이터 머신러닝 애플리케이션의 경우 처리량이 성능 메트릭이 된다.

### 지연 시간을 줄이는 방법
총 T의 지연 시간이 걸리는 작업을 하위 작업 N개로 나누어 T/N에 수행 가능하도록할 수 있다.
최적의 결과는 N개의 코어에 N개의 하위 작업이 일정한 기간 동안 수행되어야 한다. 그러나 이런 결과를 가져오는 것은 거의 힘들다. 또한 병렬로 수행된 하위 작업을 합치는 과정도 있기 때문에, 작업 시간이 길수록 멀티 스레딩 프로그래밍이 싱글 스레딩 프로그래밍보다 레이턴시가 짧아지는 교차점이 발생하게 된다.

## 처리량 최적화
엄청 긴 텍스트에서 단어가 몇 번 사용됐는지 확인하는 HTTP 서버를 만들었다. 200개의 스레드가 한 번에 요청을 보낼 경우, 싱글 스레드와 멀티 스레드 일때의 성능을 알아보자.

| 스레드 수 | 처리량(/sec) |
|---|---|
| 1 |  14.8 |
| 2 | 16.6 |
| 4 | 21.3 |
| 8 | 25.6 |
| 16 | 29.5 |

가상 스레드 수 이상으로 스레드를 늘릴 경우, 결과에는 큰 영향을 미치지 않는다.
